<!DOCTYPE html>
<html>
<head>
    <title>Test Summary Template</title>
</head>
<body>
    <div class="container">
        {% for fan in fans %}
        <div class="fan-card">
            <h3>Fan {{ loop.index }}</h3>
            
            <!-- Root-level custom optional items check (direct in fan object) -->
            {% if fan.custom_optional_items is defined or fan.custom_optional_items is mapping or fan.get('custom_optional_items[]') or fan.custom_optional_items_display_name is defined %}
            <div>
                <strong>Root-level Custom Optional Items</strong>
                
                <!-- Check for object format at root level -->
                {% if fan.custom_optional_items is mapping %}
                    {% for item_id, price in fan.custom_optional_items.items() %}
                        <div>{{ item_id|replace('_', ' ')|title }}</div>
                    {% endfor %}
                {% endif %}
                
                <!-- Check for array notation at root level -->
                {% if fan.get('custom_optional_items[]') %}
                    <div>{{ fan.get('custom_optional_items[]') }}</div>
                {% endif %}
                
                <!-- Check for display_name format -->
                {% if fan.custom_optional_items_display_name is defined %}
                    <div>{{ fan.custom_optional_items_display_name }}</div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Specifications-level custom optional items -->
            {% if fan.specifications.custom_optional_items is defined or fan.specifications.get('custom_optional_items[]') or fan.specifications.custom_option_items is defined %}
            <div>
                <strong>Specifications-level Custom Optional Items</strong>
                
                <!-- Check for object format in specifications -->
                {% if fan.specifications.custom_optional_items is mapping %}
                    {% for item_id, price in fan.specifications.custom_optional_items.items() %}
                        <div>{{ item_id|replace('_', ' ')|title }}</div>
                    {% endfor %}
                {% endif %}
                
                <!-- Check for array notation in specifications -->
                {% if fan.specifications.get('custom_optional_items[]') %}
                    <div>{{ fan.specifications.get('custom_optional_items[]') }}</div>
                {% endif %}
                
                <!-- Include custom_option_items for backward compatibility -->
                {% if fan.specifications.custom_option_items is mapping and not fan.specifications.custom_optional_items is defined %}
                    {% for item_id, price in fan.specifications.custom_option_items.items() %}
                        <div>{{ item_id|replace('_', ' ')|title }}</div>
                    {% endfor %}
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</body>
</html> 